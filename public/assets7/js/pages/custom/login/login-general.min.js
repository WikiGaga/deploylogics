"use strict";
var KTLogin = (function () {
    var t,
        n = function (n) {
            var o = "login-" + n + "-on",
                n = "kt_login_" + n + "_form";
            t.removeClass("login-forgot-on"),
                t.removeClass("login-signin-on"),
                t.removeClass("login-signup-on"),
                t.addClass(o),
                KTUtil.animateClass(
                    KTUtil.getById(n),
                    "animate__animated animate__backInUp"
                );
        },
        o = function () {
            var t;
            (t = FormValidation.formValidation(
                KTUtil.getById("kt_login_signin_form"),
                {
                    fields: {
                        email: {
                            validators: {
                                notEmpty: { message: "Email is required" },
                            },
                        },
                        password: {
                            validators: {
                                notEmpty: { message: "Password is required" },
                            },
                        },
                    },
                    plugins: {
                        trigger: new FormValidation.plugins.Trigger(),
                        submitButton: new FormValidation.plugins.SubmitButton(),
                        bootstrap: new FormValidation.plugins.Bootstrap(),
                    },
                }
            )),
                $("#kt_login_signin_submit").on("click", function (n) {
                    n.preventDefault(),
                        t.validate().then(function (t) {
                            if ("Valid" == t) {
                                $("form").find(":submit").prop("disabled", !0);
                                var n = "desktop";
                                1e3 > $("body").width() && (n = "mobile");
                                var o = new FormData(
                                    document.getElementById(
                                        "kt_login_signin_form"
                                    )
                                );
                                o.append("device", n),
                                    "desktop" == n
                                        ? $.ajax({
                                              headers: {
                                                  "X-CSRF-TOKEN": $(
                                                      'meta[name="csrf-token"]'
                                                  ).attr("content"),
                                              },
                                              url: "/login",
                                              type: "POST",
                                              data: o,
                                              cache: !1,
                                              contentType: !1,
                                              processData: !1,
                                              success: function (t, n, o, e) {
                                                  console.log(t),
                                                      "error" == t.status
                                                          ? (toastr.error(
                                                                t.message
                                                            ),
                                                            $("form")
                                                                .find(
                                                                    "input[name='_token']"
                                                                )
                                                                .val(
                                                                    t.data.token
                                                                ),
                                                            $(
                                                                'meta[name="csrf-token"]'
                                                            ).attr(
                                                                "content",
                                                                t.data.token
                                                            ),
                                                            $.ajaxSetup({
                                                                headers: {
                                                                    "X-CSRF-TOKEN":
                                                                        t.data
                                                                            .token,
                                                                },
                                                            }))
                                                          : (window.location.href =
                                                                "/home"),
                                                      $("form")
                                                          .find(":submit")
                                                          .prop("disabled", !1);
                                              },
                                              error: function (t, n) {
                                                  toastr.error(
                                                      t.responseJSON.message
                                                  );
                                                  setTimeout(function () {
                                                      $("form")
                                                          .find(":submit")
                                                          .prop("disabled", !1);
                                                  }, 2e3);
                                              },
                                          })
                                        : ($("form")
                                              .find(":submit")
                                              .prop("disabled", !1),
                                          swal
                                              .fire({
                                                  text: "Sorry, you can not login on mobile.",
                                                  icon: "error",
                                                  buttonsStyling: !1,
                                                  confirmButtonText:
                                                      "Ok, got it!",
                                                  customClass: {
                                                      confirmButton:
                                                          "btn font-weight-bold btn-light-primary",
                                                  },
                                              })
                                              .then(function () {
                                                  KTUtil.scrollTop();
                                              }));
                            } else
                                swal.fire({
                                    text: "Sorry, looks like there are some errors detected, please try again.",
                                    icon: "error",
                                    buttonsStyling: !1,
                                    confirmButtonText: "Ok, got it!",
                                    customClass: {
                                        confirmButton:
                                            "btn font-weight-bold btn-light-primary",
                                    },
                                }).then(function () {
                                    KTUtil.scrollTop();
                                });
                        });
                }),
                $("#kt_login_forgot").on("click", function (t) {
                    t.preventDefault(), n("forgot");
                }),
                $("#kt_login_signup").on("click", function (t) {
                    t.preventDefault(), n("signup");
                });
        };
    return {
        init: function () {
            (t = $("#kt_login")), o();
        },
    };
})();
jQuery(document).ready(function () {
    KTLogin.init();
});
